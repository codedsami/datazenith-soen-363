-- Create the Database
CREATE DATABASE BooksDB;

-- Connect to the newly created database
\c booksdb;

-- Authors Table (Many-to-Many Relationship)
CREATE TABLE Authors (
    author_id VARCHAR(100) PRIMARY KEY, -- OpenLibrary author_key or Archive Identifier
    name VARCHAR(255) NOT NULL -- Author Name
);

-- Books Table (Main Entity)
CREATE TABLE Books (
    book_id SERIAL PRIMARY KEY,
    title VARCHAR(500) NOT NULL,
    first_publish_year INT CHECK (first_publish_year > 0), -- Ensure valid year
    downloads INT DEFAULT 0, -- Archive.org only
    openlibrary_key VARCHAR(100) UNIQUE, -- OpenLibrary's unique identifier
    archive_identifier VARCHAR(100) UNIQUE -- Archive.org's unique identifier
);

-- Book-Author Relationship (Many-to-Many)
CREATE TABLE Book_Authors (
    book_id INT REFERENCES Books(book_id) ON DELETE CASCADE,
    author_id VARCHAR(100) REFERENCES Authors(author_id) ON DELETE CASCADE,
    PRIMARY KEY (book_id, author_id)
);

